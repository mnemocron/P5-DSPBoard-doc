\subsubsection{Schema DSP}
\label{sec:Schema_DSP}

\paragraph{I2S Schnittstelle}

\begin{table}[H]
\centering
\begin{tabular}{|l|l|c|l|l|}
\hline
\textbf{STM32} & \textbf{signal} & \textbf{direction}         & \textbf{signal} & \textbf{TLV320} \\ \hline
PC2            & MISO            & $\leftarrow$  & DOUT            & 6               \\ \hline
PC3            & MOSI            & $\rightarrow$ & DIN             & 4               \\ \hline
PB12           & WS              & $\rightarrow$ & LRCIN           & 5               \\ \hline
PB12           & WS              & $\leftarrow$  & LRCOUT          & 7               \\ \hline
PA2            & CKIN            & $\leftarrow$  & CLKOUT          & 2               \\ \hline
\end{tabular}
\caption{Signale zwischen dem DSP und dem Codec}
\end{table}


\paragraph{Bootloader und Bootpins}

Die STM32 Familie hat einen integrierten Firmware upgrade Bootloader.
Um diesen zu aktivieren müssen die externen BOOT[1:0] Pins im richtigen Muster gesetzt werden.
In diesem Projekt wird die Firmware über den USB mini-B Connector auf den STM32 überspielt.
Das Application Note AN2606 \cite[p.136]{AN2606} beschreibt die Pinkonfiguration für diesen Anwendungsfall.
So muss kein Pull-Up Widerstand an der \texttt{USB\_DP} Leitung angeschlossen sein um die OTG-Bedingungen zu erfüllen.
Ausserdem muss eine externe Clock mit einer Frequenz zwischen $4\si{MHz}$ und $26\si{MHz}$ verfügbar sein.

Die Bootpins müssen gemäss der Application Note AN2606 \cite[Table 2]{AN2606} mit dem Boot Pattern 1 gesetzt werden um den DFU Bootloader zu starten.
Unten in der Tabelle sind die beiden Boot Modi zusammengefasst.

Der BOOT1 Pin ist beim STM32F412 auf PB2.

\begin{table}[H]
\centering
\begin{tabular}{|l|c|c|}
\hline
\textbf{Boot Mode} & \textbf{BOOT1} & \textbf{BOOT0} \\ \hline
Bootloader         & 0              & 1              \\ \hline
Normal             & 0              & 0              \\ \hline
\end{tabular}
\caption{Mode Auswahl über BOOT[1:0] Pins}
\end{table}


\paragraph{Rotary Encoder und Buttons}

Einige Timer des STM32 unterstützen einen Encoder Modus, bei dem 2 GPIO Inputs zum Zählen der Encoderpulse verwendet werden können.

Alle 4 Pushbuttons sind an interruptfähige (EXTI) GPIO Pins angeschlossen. 
Die STM32 Familie unterstützt externe GPIO Interrupts an allen Pins. 
Dabei stehen 16 Interrupt Channel zur Verfügung, von welchen die Channel Nummer jeweils auf die GPIO Port Nummer passen muss. 
Wie in der nachfolgenden Tabelle aufgeführt, werden gesammthaft 4 EXTI Channels belegt.

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|}
\hline
\textbf{Signal}  & \textbf{GPIO} & \textbf{EXTI} \\ \hline
Encoder 1 Button & PC12          & 12            \\ \hline
Encoder 2 Button & PB13          & 13            \\ \hline
Button 1         & PA0           & 0             \\ \hline
Button 2         & PA1           & 1             \\ \hline
\end{tabular}
\caption{GPIO Mapping auf EXTI Interrupt Channels}
\end{table}





